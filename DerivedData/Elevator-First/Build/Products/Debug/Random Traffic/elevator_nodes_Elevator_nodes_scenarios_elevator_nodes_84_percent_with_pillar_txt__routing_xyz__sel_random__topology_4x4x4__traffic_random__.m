% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_random__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_84_percent_with_pillar.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic random  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_random__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
            0.001        15.3142     0.00751736             54    2.24344e-07            611           4330
            0.001        15.2291     0.00675868             56    2.06797e-07            550           3893
            0.001        14.9233      0.0070625             60    2.06077e-07            574           4068
            0.001        15.6291     0.00713228             56    2.12931e-07            577           4044
            0.001         15.439     0.00677431             53    2.07005e-07            549           3902
            0.001        15.0193     0.00702257             61    2.06947e-07            570           4045
            0.001        15.9912     0.00700347             67    2.14286e-07            569           4034
            0.001        15.7677     0.00661632             55    1.99047e-07            538           3811
            0.001        15.6758      0.0067066             62    2.01605e-07            549           3863
            0.001        15.5324     0.00736111             81    2.16343e-07            601           4240
           0.0015         17.214        0.01075            100    3.21193e-07            869           6192
           0.0015         17.205       0.010684             85    3.21029e-07            873           6154
           0.0015        15.7878     0.00978646             72    2.94392e-07            787           5637
           0.0015        16.5959      0.0103628             72    3.07418e-07            839           5969
           0.0015        16.0324      0.0105712             78    3.18371e-07            863           6089
           0.0015         16.148      0.0102396             56    3.06713e-07            838           5898
           0.0015        16.5335      0.0107344             86    3.17917e-07            866           6183
           0.0015        16.7891      0.0103455             68    3.19465e-07            844           5959
           0.0015        16.8676      0.0108403             71    3.19625e-07            876           6244
           0.0015        16.3297      0.0103368             67    3.08529e-07            834           5954
            0.002        17.5685      0.0144063            109    4.17373e-07           1161           8298
            0.002        17.6892       0.014566             80     4.3214e-07           1181           8390
            0.002        16.8992      0.0137188             74    4.03116e-07           1111           7902
            0.002        18.0758      0.0146441             76    4.35001e-07           1187           8435
            0.002        17.9421      0.0133837             86      4.044e-07           1088           7709
            0.002        19.0291      0.0145087             99    4.38133e-07           1167           8357
            0.002        17.1951      0.0136441             81    4.07377e-07           1107           7859
            0.002        17.5534      0.0141215            106    4.22576e-07           1142           8134
            0.002        17.9215      0.0140694             91    4.13098e-07           1134           8104
            0.002        18.5543      0.0136372            113    4.18224e-07           1104           7855
           0.0025        19.9865      0.0184462            128    5.46057e-07           1486          10625
           0.0025        19.3776      0.0176562            129    5.17196e-07           1417          10170
           0.0025        19.4735       0.017283            130    5.05828e-07           1394           9955
           0.0025        18.3362      0.0170642             95    5.04387e-07           1377           9829
           0.0025        20.7853      0.0182552            155    5.40255e-07           1467          10515
           0.0025        21.2404      0.0188611            125      5.602e-07           1510          10864
           0.0025        19.6231      0.0172274            159    5.12373e-07           1393           9923
           0.0025        19.8602      0.0173212            166     5.1842e-07           1395           9977
           0.0025        19.7129      0.0177917            123    5.43394e-07           1428          10248
           0.0025        20.0644      0.0180052            155    5.46356e-07           1443          10371
            0.003        23.5661      0.0212066            203    6.34757e-07           1703          12215
            0.003        22.3335      0.0219514            251    6.47078e-07           1748          12644
            0.003        21.0018      0.0207292            141    6.09002e-07           1660          11940
            0.003        20.6581        0.02075            128    6.08501e-07           1664          11952
            0.003        22.0324      0.0207274            243    6.04865e-07           1666          11939
            0.003        21.8864      0.0212795            154    6.24876e-07           1708          12257
            0.003        22.1707      0.0206528            207     6.2706e-07           1652          11896
            0.003        21.4502      0.0214097            123    6.32419e-07           1717          12332
            0.003        23.2429      0.0216059            227    6.34502e-07           1729          12445
            0.003        21.3098      0.0213924            154    6.20778e-07           1711          12322
           0.0035        27.0127      0.0267708            363     7.7899e-07           2127          15420
           0.0035        27.4347      0.0253594            368    7.64329e-07           2015          14607
           0.0035        26.6227      0.0246215            282    7.18198e-07           1948          14182
           0.0035        31.2702      0.0254514            385    7.42736e-07           2017          14660
           0.0035        23.1523      0.0239323            252    7.09301e-07           1911          13785
           0.0035        27.0892      0.0260747            382    7.71532e-07           2063          15019
           0.0035        24.6233      0.0241458            217    7.27108e-07           1930          13908
           0.0035         28.751      0.0245521            267    7.43321e-07           1952          14142
           0.0035        24.9754      0.0249878            213    7.34142e-07           1988          14393
           0.0035        26.5772      0.0254149            355    7.46441e-07           2020          14639
            0.004        29.8372       0.029026            244    8.53594e-07           2309          16719
            0.004        38.9678      0.0286736            715    8.32901e-07           2265          16516
            0.004        33.5807      0.0283281            388    8.35503e-07           2249          16317
            0.004        60.9234      0.0309635           1303    9.07484e-07           2416          17835
            0.004        37.5062      0.0293767            376    8.52582e-07           2323          16921
            0.004        42.8286      0.0297552           1016    8.78305e-07           2340          17139
            0.004        34.8106      0.0290642            376    8.54922e-07           2297          16741
            0.004        35.8095      0.0278507            410    8.15115e-07           2194          16042
            0.004        31.7213      0.0284549            264    8.28945e-07           2246          16390
            0.004        34.4011      0.0286233            537    8.38493e-07           2259          16487
           0.0045        88.4966      0.0338437           2344    9.86421e-07           2648          19494
           0.0045        50.7222      0.0321042           1170    9.44548e-07           2531          18492
           0.0045        66.8385      0.0325573           1630    9.40748e-07           2557          18753
           0.0045        135.092      0.0335347           3809    9.63702e-07           2607          19316
           0.0045        46.4271      0.0319323           1080    9.38333e-07           2510          18393
           0.0045        58.2228      0.0323056            612    9.46062e-07           2523          18608
           0.0045        63.1491      0.0319149           1308    9.39914e-07           2502          18383
           0.0045         168.68      0.0329149           3460    9.55584e-07           2557          18959
           0.0045         81.061      0.0319306           2443    9.30601e-07           2491          18392
           0.0045        50.7156      0.0325399           1420    9.42381e-07           2549          18743
            0.005        277.842      0.0357257           4501    1.01219e-06           2743          20578
            0.005         259.73      0.0355399           7020    1.01583e-06           2723          20471
            0.005        244.378      0.0351094           5704    1.01698e-06           2696          20223
            0.005        239.367      0.0352622           5438    1.00071e-06           2696          20311
            0.005         222.23       0.034441           5950    9.90089e-07           2656          19838
            0.005        261.653      0.0351667           4294     9.9789e-07           2695          20256
            0.005        145.695      0.0357066           2751    1.01662e-06           2755          20567
            0.005        231.745      0.0353646           4507    1.00921e-06           2721          20370
            0.005        182.617       0.035434           2967    1.01362e-06           2733          20410
            0.005        400.821      0.0352274           6373    9.84671e-07           2677          20291
           0.0055        517.525      0.0352813           6792    9.96213e-07           2698          20322
           0.0055         447.26      0.0352413           8850    1.00594e-06           2682          20299
           0.0055        349.817      0.0355694           7317    1.02378e-06           2718          20488
           0.0055        383.275      0.0362569           5779    1.02661e-06           2770          20884
           0.0055        385.456      0.0352396           7623    1.00775e-06           2688          20298
           0.0055        356.933       0.035599           5958    1.00212e-06           2725          20505
           0.0055        340.061      0.0368872           7001    1.04782e-06           2824          21247
           0.0055        366.633      0.0359306           7176    1.02075e-06           2740          20696
           0.0055        488.774      0.0349948           7516    1.00604e-06           2674          20157
           0.0055        423.845      0.0360347           7541    1.02357e-06           2750          20756
            0.006         630.09      0.0365521           8652    1.02148e-06           2776          21054
            0.006        575.838       0.036849           7841    1.03234e-06           2790          21225
            0.006        545.823      0.0367795           7915    1.02799e-06           2787          21185
            0.006        511.426      0.0368889           8762    1.02984e-06           2810          21248
            0.006        427.342      0.0357813           9084    1.00796e-06           2713          20610
            0.006        440.786      0.0367292           7308    1.02933e-06           2792          21156
            0.006        518.653      0.0361372           7276    1.01963e-06           2736          20815
            0.006        634.161      0.0363351           8348    1.01121e-06           2751          20929
            0.006        534.251      0.0356615           8232    1.00223e-06           2722          20541
            0.006        614.058      0.0346632           7760    9.83993e-07           2635          19966
           0.0065        730.487      0.0352153           8216    9.94287e-07           2662          20284
           0.0065        527.187      0.0393194           8090    1.08915e-06           2986          22648
           0.0065        540.192      0.0366545           8440    1.01749e-06           2780          21113
           0.0065        584.319      0.0369549           8388    1.02114e-06           2819          21286
           0.0065        663.119      0.0347483           7774    9.79748e-07           2638          20015
           0.0065        649.652      0.0351458           8758    9.89304e-07           2663          20244
           0.0065        570.273      0.0366649           7895    1.03632e-06           2784          21119
           0.0065        638.607      0.0337205           8933    9.44674e-07           2560          19423
           0.0065        647.923      0.0343142           8365    9.61276e-07           2585          19765
           0.0065        559.695      0.0359722           7926    1.00525e-06           2728          20720
            0.007        760.818      0.0361007           8659    9.93743e-07           2737          20794
            0.007        760.105       0.035316           8710    9.91037e-07           2682          20342
            0.007        895.087      0.0346111           8930    9.54444e-07           2616          19936
            0.007        594.841      0.0366823           8473    1.01683e-06           2779          21129
            0.007         690.84      0.0349705           7822    9.62186e-07           2652          20143
            0.007        800.085       0.035816           8588    9.88465e-07           2708          20630
            0.007        848.395      0.0358767           8508    9.87489e-07           2714          20665
            0.007        737.881      0.0356059           8772    9.75404e-07           2701          20509
            0.007        733.276      0.0351181           9166    9.75314e-07           2663          20228
            0.007        701.194      0.0366007           8340    9.99962e-07           2774          21082
           0.0075         639.48      0.0354757           8617    9.86344e-07           2705          20434
           0.0075        749.986      0.0374965           8785    1.02203e-06           2844          21598
           0.0075        901.006      0.0353785           8543    9.92369e-07           2688          20378
           0.0075        924.173      0.0362205           8114    9.88071e-07           2735          20863
           0.0075        768.724      0.0342222           9498    9.54801e-07           2592          19712
           0.0075        841.126      0.0374896           9146    1.01389e-06           2838          21594
           0.0075        827.164       0.036625           8335    9.94903e-07           2778          21096
           0.0075        729.992      0.0379792           9639    1.02166e-06           2876          21876
           0.0075        661.817      0.0360243           9480    1.00048e-06           2736          20750
           0.0075        837.412      0.0359531           8349     1.0074e-06           2723          20709
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
