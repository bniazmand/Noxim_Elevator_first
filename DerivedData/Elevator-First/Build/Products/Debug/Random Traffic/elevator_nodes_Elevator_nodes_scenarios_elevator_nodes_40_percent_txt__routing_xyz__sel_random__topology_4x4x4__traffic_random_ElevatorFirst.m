% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_40_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_random__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_40_percent.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic random  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_40_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_random__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
            0.005        13.5511      0.0347465             88    7.67986e-07           2789          20014
            0.005        13.8995      0.0344635             94    7.67376e-07           2745          19851
            0.005        14.0098      0.0354896             77    7.83472e-07           2851          20442
            0.005        14.0517      0.0361372            107    8.07625e-07           2900          20815
            0.005        13.8025      0.0354913             66    7.94809e-07           2850          20443
            0.005        13.3216      0.0348021             75    7.65261e-07           2783          20046
            0.005        14.0042       0.035625             79    7.86977e-07           2849          20520
            0.005        14.1444      0.0349497            109    7.72223e-07           2797          20131
            0.005        13.7538      0.0352535             95    7.70711e-07           2815          20306
            0.005        14.1371       0.036125            132    7.93779e-07           2882          20808
            0.007        16.3646      0.0513559            349    1.12252e-06           4073          29581
            0.007        14.9488      0.0471736            120    1.05021e-06           3728          27172
            0.007        15.9667      0.0488733            169    1.07001e-06           3879          28151
            0.007        15.6061      0.0497222            163    1.07673e-06           3932          28640
            0.007        16.5117       0.049658            160    1.09714e-06           3932          28603
            0.007        16.0793      0.0491094            147    1.08216e-06           3873          28287
            0.007        15.7924      0.0501979            120    1.10451e-06           3974          28914
            0.007        15.7845      0.0501719            132    1.10395e-06           3996          28899
            0.007        16.4429      0.0494931            200    1.09506e-06           3933          28508
            0.007        16.1367      0.0489427            153    1.08184e-06           3892          28191
            0.009        19.6693      0.0636424            218     1.3888e-06           4995          36658
            0.009        21.6929      0.0638663            315    1.40374e-06           5005          36787
            0.009        23.3953      0.0660868            457     1.4328e-06           5155          38066
            0.009        18.4818      0.0637014            172    1.38096e-06           4969          36692
            0.009        23.1814      0.0638785            423    1.40824e-06           5012          36794
            0.009        19.6015      0.0662934            258    1.43905e-06           5199          38185
            0.009        18.9817      0.0646719            161    1.40804e-06           5081          37251
            0.009        19.4781      0.0637569            360     1.3874e-06           5012          36724
            0.009         20.284      0.0641319            234    1.40985e-06           5000          36940
            0.009        20.0717      0.0638941            237    1.40122e-06           5023          36803
            0.011        42.9667      0.0809931            931    1.76125e-06           6254          46652
            0.011        29.0151      0.0786128            530    1.70649e-06           6104          45281
            0.011         30.867      0.0775503            967    1.69093e-06           6015          44669
            0.011        31.1595      0.0782309            607    1.70635e-06           6061          45061
            0.011        29.2638      0.0796233            412    1.73419e-06           6163          45863
            0.011        28.7301      0.0791198            416    1.70296e-06           6151          45573
            0.011        29.7262      0.0798767            502    1.75387e-06           6177          46009
            0.011        34.5883      0.0805538            646    1.75063e-06           6250          46399
            0.011        34.6391       0.079158            703    1.71844e-06           6134          45595
            0.011        28.7483       0.077875            626    1.67201e-06           6042          44856
            0.013        90.1437      0.0928941           2769    1.98368e-06           7110          53507
            0.013        87.1896      0.0944097           3547    2.01198e-06           7206          54380
            0.013        132.588      0.0927188           3902    1.98134e-06           7073          53406
            0.013        219.843      0.0926007           5699    1.98199e-06           7088          53338
            0.013        142.302      0.0926632           4134    1.98053e-06           7055          53374
            0.013        261.296      0.0906163           5206    1.94252e-06           6922          52195
            0.013        58.1431       0.091316           1471    1.95556e-06           7014          52598
            0.013        101.094      0.0920174           2559     1.9753e-06           7066          53002
            0.013        101.426      0.0940677           4278    2.00527e-06           7157          54183
            0.013        80.5579      0.0928681           2822    1.99578e-06           7109          53492
            0.015         207.12       0.102394           5635    2.15805e-06           7795          58979
            0.015        382.234      0.0997795           5614    2.09172e-06           7540          57473
            0.015        227.077       0.103422           5833    2.19484e-06           7849          59571
            0.015        293.931       0.105212           6264      2.242e-06           7935          60602
            0.015        242.871       0.103892           5019    2.19266e-06           7857          59842
            0.015         242.76       0.096967           6416    2.05714e-06           7351          55853
            0.015        221.506       0.102413           5642    2.17894e-06           7753          58990
            0.015        236.794       0.103345           5610     2.1884e-06           7869          59527
            0.015        187.301      0.0973733           6765    2.05897e-06           7385          56087
            0.015        196.177       0.105175           5301    2.19492e-06           7994          60581
            0.017        427.253       0.108755           6515    2.27196e-06           8167          62643
            0.017        302.725       0.109925           6524    2.30823e-06           8254          63317
            0.017        508.095       0.110387           6880    2.30609e-06           8290          63583
            0.017        385.033       0.105462           7924    2.23288e-06           7947          60746
            0.017        357.118       0.109189           6520     2.3006e-06           8225          62893
            0.017        480.596       0.108318           6064    2.26145e-06           8134          62391
            0.017        564.785       0.107328           7829    2.24547e-06           8064          61821
            0.017         513.66       0.102891           8095    2.17455e-06           7748          59265
            0.017        455.733       0.109908           7145    2.31741e-06           8237          63307
            0.017        384.227       0.113245           6785    2.35033e-06           8483          65229
            0.019        778.603       0.109451           8025    2.24312e-06           8209          63044
            0.019        774.751       0.111196           7688     2.3201e-06           8308          64049
            0.019        763.263       0.109707           8172    2.30325e-06           8194          63191
            0.019         717.88       0.111161           7814    2.32081e-06           8354          64029
            0.019         577.44       0.114753           7509     2.3651e-06           8586          66098
            0.019        698.273       0.111491           7479    2.34456e-06           8342          64219
            0.019        627.384       0.112957           8064    2.37025e-06           8440          65063
            0.019        694.137         0.1117           7844    2.31729e-06           8348          64339
            0.019        565.847       0.113774           7937    2.37597e-06           8514          65534
            0.019        932.988       0.107198           7752    2.22956e-06           8027          61746
            0.021        775.895       0.117674           8189    2.42373e-06           8751          67780
            0.021        907.914       0.108953           8097    2.28721e-06           8101          62757
            0.021        915.607       0.120399           7800    2.48312e-06           8941          69350
            0.021        897.506       0.112663           7520    2.33707e-06           8433          64894
            0.021        808.264       0.119186           7512    2.45022e-06           8912          68651
            0.021        814.636       0.116304           8254    2.42071e-06           8723          66991
            0.021        919.313       0.109292           8576     2.2796e-06           8149          62952
            0.021        721.931       0.116594           8292    2.40928e-06           8719          67158
            0.021        762.871        0.10947           9014    2.27616e-06           8166          63055
            0.021        1244.15       0.106773           8127    2.21525e-06           7973          61501
            0.023        1170.49       0.109998           8460    2.29361e-06           8178          63359
            0.023        1114.19       0.117688           8146    2.43016e-06           8744          67788
            0.023        936.916       0.115913           8181     2.3972e-06           8613          66766
            0.023        1086.68       0.114314           8260    2.37565e-06           8498          65845
            0.023        867.912       0.116009           8727    2.43793e-06           8637          66821
            0.023        1211.38       0.115936           8526    2.40078e-06           8630          66779
            0.023        1044.99       0.117299           8406    2.39181e-06           8734          67564
            0.023        1139.05       0.107816           8754    2.22938e-06           8031          62102
            0.023        1068.79       0.117149           8348    2.43589e-06           8685          67478
            0.023        948.263       0.115899           8447    2.39519e-06           8638          66758
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
