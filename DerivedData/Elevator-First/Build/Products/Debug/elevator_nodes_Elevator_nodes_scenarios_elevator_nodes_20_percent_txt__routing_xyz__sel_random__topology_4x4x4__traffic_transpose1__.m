% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_20_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_20_percent.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic transpose1  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_20_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
           0.0095         58.519      0.0678681           2479    1.63199e-06           5241          39092
           0.0095          61.32      0.0656997           6941    1.61544e-06           5065          37843
           0.0095        60.1332      0.0680104           4040    1.65123e-06           5242          39174
           0.0095          73.36      0.0680035           5980    1.65607e-06           5231          39170
           0.0095        47.1933      0.0668611           3768    1.62679e-06           5172          38512
           0.0095        51.6047      0.0681823           2733    1.64064e-06           5267          39273
           0.0095        56.8324      0.0683924           3029    1.66389e-06           5287          39394
           0.0095         78.628      0.0680191           7193    1.65346e-06           5237          39179
           0.0095        64.4029      0.0680087           6921    1.63921e-06           5230          39173
           0.0095        49.9069      0.0684792           3786    1.67064e-06           5283          39444
             0.01        73.0465      0.0702413           6457    1.69989e-06           5422          40459
             0.01        61.7898         0.0715           4784    1.73058e-06           5476          41184
             0.01        74.0537      0.0719618           8492    1.75393e-06           5545          41450
             0.01        71.7062      0.0717795           4778    1.72465e-06           5514          41345
             0.01        58.3702      0.0707726           6358    1.72285e-06           5446          40765
             0.01        89.3979      0.0721319           7485      1.734e-06           5547          41548
             0.01        58.5201      0.0702118           4640    1.71458e-06           5411          40442
             0.01         92.788      0.0709375           7118    1.72098e-06           5439          40860
             0.01        65.3733      0.0713628           6924    1.72773e-06           5470          41105
             0.01         75.171      0.0712222           4945    1.72905e-06           5479          41024
           0.0105        117.343      0.0750521           8128    1.80013e-06           5719          43230
           0.0105        73.5528      0.0749878           5647    1.81917e-06           5738          43193
           0.0105        106.654      0.0756285           7352    1.83662e-06           5782          43562
           0.0105        119.474       0.074849           6858    1.81248e-06           5716          43113
           0.0105        103.766      0.0752083           6735    1.80524e-06           5732          43320
           0.0105        82.7305      0.0751788           7414    1.81282e-06           5743          43303
           0.0105        102.445      0.0745295           5870     1.8037e-06           5698          42929
           0.0105        58.3507      0.0745799           4398    1.79472e-06           5692          42958
           0.0105        79.5845      0.0736181           5822    1.78419e-06           5629          42404
           0.0105        80.0663      0.0767431           4348    1.81422e-06           5885          44204
            0.011        91.3901      0.0776128           7940    1.84853e-06           5919          44705
            0.011        147.839      0.0772569           7166    1.84754e-06           5886          44500
            0.011        111.333      0.0783576           7946    1.85569e-06           5973          45134
            0.011         114.97      0.0775712           7675    1.87599e-06           5923          44681
            0.011        128.404      0.0778229           7109    1.86529e-06           5934          44826
            0.011        105.094      0.0799306           6768    1.89492e-06           6107          46040
            0.011        109.977      0.0761823           8654    1.82318e-06           5830          43881
            0.011        113.024      0.0769965           7323    1.84603e-06           5888          44350
            0.011        149.371      0.0785903           8201    1.86959e-06           5965          45268
            0.011         167.66       0.079026           8394    1.88157e-06           6018          45519
           0.0115        137.465      0.0789375           8300    1.90574e-06           6026          45468
           0.0115        146.451      0.0807917           8445    1.93158e-06           6138          46536
           0.0115        146.336      0.0803663           8737    1.91216e-06           6087          46291
           0.0115        111.474      0.0804913           5440    1.91213e-06           6124          46363
           0.0115        125.902      0.0812344           8381    1.93943e-06           6187          46791
           0.0115        110.754      0.0805729           7593    1.92324e-06           6130          46410
           0.0115        135.673      0.0811753           7950    1.93262e-06           6188          46757
           0.0115        127.664      0.0812326           7150    1.92665e-06           6205          46790
           0.0115        125.823      0.0806146           7061    1.91935e-06           6119          46434
           0.0115         188.31       0.082092           8422    1.93913e-06           6235          47285
            0.012        140.615      0.0849722           6563    2.01019e-06           6459          48944
            0.012        116.254      0.0830799           8690    1.97515e-06           6303          47854
            0.012        183.784      0.0820243           8072    1.94836e-06           6224          47246
            0.012        168.306      0.0832674           7536     1.9912e-06           6325          47962
            0.012        146.917      0.0834653           8100    1.99617e-06           6353          48076
            0.012        144.629       0.085026           8206    2.00446e-06           6441          48975
            0.012        144.357      0.0818576           6511    1.94267e-06           6207          47150
            0.012        178.545      0.0836927           8943    1.98219e-06           6364          48207
            0.012         199.14      0.0823542           8035    1.94267e-06           6238          47436
            0.012        222.238      0.0839514           8408    1.98055e-06           6336          48356
           0.0125        214.284      0.0856042           8005    2.01947e-06           6504          49308
           0.0125        198.926      0.0861424           7346    2.04119e-06           6527          49618
           0.0125        197.907      0.0883611           8912    2.05985e-06           6673          50896
           0.0125        217.036      0.0859028           8578    2.00835e-06           6516          49480
           0.0125          226.5      0.0844167           8964    1.99193e-06           6390          48624
           0.0125        153.388      0.0870799           7805    2.07277e-06           6611          50158
           0.0125        169.524      0.0848125           7988    2.00704e-06           6432          48852
           0.0125        149.912      0.0866337           7918    2.04088e-06           6561          49901
           0.0125        236.309      0.0855642           9165    2.01207e-06           6481          49285
           0.0125        194.627      0.0861354           8581    2.03325e-06           6516          49614
            0.013        183.505      0.0879948           8992    2.08689e-06           6672          50685
            0.013        274.407      0.0882622           8419    2.04863e-06           6655          50839
            0.013        191.008      0.0873125           8032     2.0696e-06           6599          50292
            0.013        165.508      0.0882465           7986    2.08165e-06           6679          50830
            0.013         241.93      0.0876944           8301      2.054e-06           6631          50512
            0.013        203.965      0.0884601           7104    2.03615e-06           6692          50953
            0.013        211.904      0.0880625           7729    2.07236e-06           6644          50724
            0.013        201.185      0.0876962           8097    2.05831e-06           6636          50513
            0.013        252.291      0.0892483           8512    2.04956e-06           6760          51407
            0.013        225.205      0.0904727           8440    2.06463e-06           6723          51298
           0.0135        234.621      0.0895035           8726    2.07022e-06           6762          51554
           0.0135        261.166      0.0899896           8356    2.08468e-06           6787          51834
           0.0135        212.777      0.0888698           8526    2.07853e-06           6696          51189
           0.0135        217.563      0.0931476           9141    2.17415e-06           7016          53653
           0.0135        242.416      0.0892363           7486    2.04298e-06           6633          50597
           0.0135        222.196      0.0919149           7772    2.12655e-06           6935          52943
           0.0135        221.392      0.0889965           8448    2.07733e-06           6702          51262
           0.0135        170.736       0.094448           7707    2.16126e-06           7012          53552
           0.0135        217.128      0.0886528           8939    2.06982e-06           6676          51064
           0.0135         192.28      0.0920608           7654    2.15358e-06           6931          53027
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
