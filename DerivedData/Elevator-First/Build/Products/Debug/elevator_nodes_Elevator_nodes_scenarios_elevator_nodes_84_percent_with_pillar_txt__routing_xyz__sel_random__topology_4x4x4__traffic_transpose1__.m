% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_84_percent_with_pillar.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic transpose1  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
           0.0001        19.0588     0.00120202             32    2.60753e-08             51            357
           0.0001        18.0984     0.00115989             36    2.55189e-08             61            428
           0.0001        19.4068     0.00117664             32    2.85808e-08             59            413
           0.0001        17.7455     0.00118827             32    2.47757e-08             55            385
           0.0001        17.8966     0.00108672             33    2.60324e-08             58            401
           0.0001        17.8654     0.00109009             32    2.29162e-08             52            363
           0.0001        17.3636     0.00113704             32    1.99488e-08             44            307
           0.0001        18.0377     0.00111411             32    2.48689e-08             53            371
           0.0001        19.3846     0.00126389             45    3.15512e-08             65            455
           0.0001        19.3188      0.0012197             32    3.39631e-08             69            483
           0.0003        20.6949     0.00232957             57     8.9893e-08            177           1237
           0.0003        19.7711      0.0021439             55    7.72999e-08            166           1177
           0.0003         18.038     0.00216179             42    7.09848e-08            158           1109
           0.0003        19.5026     0.00242504             46    9.32601e-08            195           1375
           0.0003        19.3778     0.00238983             45    8.40749e-08            180           1269
           0.0003        19.1693     0.00234921             49    8.92648e-08            189           1332
           0.0003        19.1818     0.00251971             44    8.84705e-08            198           1406
           0.0003          19.81     0.00256102             60    9.14448e-08            200           1406
           0.0003        18.9623     0.00207778             45    7.76657e-08            159           1122
           0.0003        19.5344     0.00245926             45     8.7322e-08            189           1328
           0.0005        19.9354     0.00327513             49    1.29543e-07            263           1857
           0.0005        21.4578     0.00380035             62    1.51918e-07            308           2189
           0.0005        20.3333     0.00332796             71    1.31113e-07            261           1857
           0.0005        20.0128     0.00382292             53    1.48555e-07            313           2202
           0.0005         20.682     0.00347049             62    1.38634e-07            283           1999
           0.0005        19.8566     0.00340437             58    1.29444e-07            265           1869
           0.0005        20.1719     0.00358423             51    1.36946e-07            285           2000
           0.0005        20.2542     0.00368078             62    1.39823e-07            295           2087
           0.0005        20.1848     0.00376896             61     1.4086e-07            303           2137
           0.0005        19.5741     0.00330208             62    1.30833e-07            270           1902
           0.0007        20.3484     0.00494618             84    1.81055e-07            399           2849
           0.0007         21.171     0.00517014             59    1.97972e-07            421           2978
           0.0007        21.3318     0.00517014             63    2.05238e-07            422           2978
           0.0007        21.8828     0.00494792             76    1.98285e-07            401           2850
           0.0007        22.2137      0.0047037             67    1.92328e-07            379           2667
           0.0007        20.6768     0.00482465             58    1.86054e-07            393           2779
           0.0007         20.855     0.00479687             63    1.89242e-07            393           2763
           0.0007         21.359     0.00463368             60    1.83825e-07            376           2669
           0.0007         20.477     0.00481771             62    1.80601e-07            392           2775
           0.0007          21.26     0.00492535             63    1.95161e-07            400           2837
           0.0009         22.475     0.00615625             72    2.46371e-07            501           3546
           0.0009        23.2078     0.00628125             85     2.5122e-07            510           3618
           0.0009        22.6983     0.00647917             81    2.56008e-07            527           3732
           0.0009        21.9485      0.0059566             81    2.36432e-07            485           3431
           0.0009        21.4294     0.00637847             76    2.37836e-07            517           3674
           0.0009        23.8755     0.00621528             91    2.49697e-07            506           3580
           0.0009        21.4527     0.00594965             80    2.27656e-07            486           3427
           0.0009        25.1645      0.0065816            186    2.54321e-07            535           3791
           0.0009        21.8836     0.00642187             75    2.50288e-07            524           3699
           0.0009        22.6317     0.00640625             76    2.47176e-07            524           3690
           0.0011        22.9439     0.00765799             96    2.99049e-07            624           4411
           0.0011        25.1586     0.00799306            106    3.09763e-07            643           4604
           0.0011        24.0661     0.00769271            105      2.958e-07            620           4431
           0.0011        22.8419     0.00763542             69    2.93574e-07            620           4398
           0.0011        22.4679     0.00732639            123    2.71429e-07            592           4220
           0.0011        23.5498     0.00792014             79    3.00395e-07            642           4562
           0.0011        24.3371     0.00760243            110    2.99564e-07            617           4379
           0.0011        23.7326     0.00704688            108    2.82156e-07            576           4059
           0.0011         23.361     0.00717361            103    2.86066e-07            579           4132
           0.0011        23.4108     0.00734896             80    2.95615e-07            594           4233
           0.0013         25.632     0.00904167            102    3.56894e-07            731           5208
           0.0013        25.9877     0.00907292            130    3.45748e-07            730           5226
           0.0013        28.1132     0.00947743            390    3.51526e-07            760           5459
           0.0013        25.6058     0.00895833            106    3.51779e-07            728           5160
           0.0013        25.1852     0.00926215            107    3.59481e-07            745           5335
           0.0013        25.0411     0.00902431            176    3.46347e-07            730           5198
           0.0013        24.5566     0.00904167            190    3.46318e-07            733           5208
           0.0013        24.9586     0.00922917            110      3.517e-07            749           5316
           0.0013        24.1067     0.00924132            123    3.46572e-07            750           5323
           0.0013        23.1203     0.00850868             81     3.3277e-07            690           4901
           0.0015        29.2275      0.0110729            146    4.33914e-07            888           6378
           0.0015        28.3528      0.0109427            139    4.16182e-07            873           6303
           0.0015        27.8792      0.0106337            148    4.13476e-07            853           6125
           0.0015        29.6893      0.0110278            154    4.29693e-07            885           6352
           0.0015        30.0044      0.0111753            147    4.36511e-07            900           6437
           0.0015         29.209      0.0104965            201    4.00499e-07            847           6046
           0.0015        25.8294      0.0104132             91    4.01807e-07            838           5998
           0.0015        29.2375      0.0103802            131    4.06127e-07            838           5979
           0.0015        29.2514      0.0113715            148    4.37673e-07            915           6550
           0.0015        27.9359      0.0103559            153    3.84947e-07            827           5965
           0.0017        33.3672      0.0118073            401    4.67994e-07            945           6801
           0.0017        31.7175      0.0120608            209    4.63953e-07            970           6947
           0.0017        27.9727      0.0118385            132    4.51855e-07            951           6819
           0.0017        36.5744      0.0125573            271    4.85511e-07           1001           7233
           0.0017        34.0493      0.0121267            257    4.69228e-07            973           6985
           0.0017        32.8051      0.0125538            273    4.77149e-07           1011           7231
           0.0017        32.5626      0.0122396            250    4.60082e-07            983           7050
           0.0017        29.8103      0.0120503            172    4.63269e-07            975           6941
           0.0017        31.7089      0.0116372            258    4.56232e-07            931           6703
           0.0017        30.3319      0.0118177            251    4.54268e-07            949           6807
           0.0019        41.2438      0.0136163            342    5.18183e-07           1083           7843
           0.0019        36.4904      0.0143021            309    5.35525e-07           1142           8238
           0.0019        32.6156      0.0135851            205    5.13128e-07           1090           7825
           0.0019        33.5626      0.0132812            242    5.10717e-07           1070           7650
           0.0019        34.3405      0.0133941            168    5.02825e-07           1072           7715
           0.0019         47.226      0.0134635            751    5.21596e-07           1071           7755
           0.0019        38.7639      0.0137483            316     5.2048e-07           1101           7919
           0.0019        37.8965      0.0134583            474    5.26075e-07           1072           7752
           0.0019         37.417      0.0140625            319    5.29905e-07           1120           8100
           0.0019        37.0218       0.013691            330    5.33154e-07           1101           7886
           0.0021        63.3662      0.0153733            807     5.9088e-07           1218           8855
           0.0021        47.3051      0.0147726            478    5.72807e-07           1180           8509
           0.0021        46.1764      0.0151719            824     5.7385e-07           1202           8739
           0.0021         55.728      0.0149566           1247     5.7079e-07           1184           8615
           0.0021        52.3588      0.0156076            875    5.83478e-07           1243           8990
           0.0021        57.6015       0.015559            573    5.96366e-07           1232           8962
           0.0021         53.857      0.0154601            823    5.94447e-07           1224           8905
           0.0021          51.18      0.0153854            750    5.97779e-07           1222           8862
           0.0021        54.6538      0.0156267            785    5.88343e-07           1242           9001
           0.0021         42.957      0.0145955            362    5.54388e-07           1164           8407
           0.0023        52.9137      0.0160399            544      6.023e-07           1274           9239
           0.0023        51.2275      0.0162656            735    6.20793e-07           1288           9369
           0.0023        126.937      0.0171372           2507    6.40022e-07           1339           9871
           0.0023        71.9985      0.0168125           1228    6.35399e-07           1331           9684
           0.0023        57.5381      0.0159167            660    5.99022e-07           1260           9168
           0.0023        84.8685       0.016526           1388    6.14501e-07           1300           9519
           0.0023        64.7149      0.0164705            825    6.32302e-07           1305           9487
           0.0023        57.6294      0.0162865            501    6.11743e-07           1287           9381
           0.0023        57.6905      0.0161163            842    6.07769e-07           1273           9283
           0.0023        62.2989      0.0160677            977    6.10165e-07           1268           9255
           0.0025        226.761      0.0184392           6198    6.95446e-07           1420          10621
           0.0025        109.312      0.0181615           1717    6.76403e-07           1414          10461
           0.0025        139.917      0.0181076           3113    6.78953e-07           1404          10430
           0.0025        152.138      0.0185556           2330    6.87826e-07           1440          10688
           0.0025        195.354      0.0183559           3373    6.93319e-07           1419          10573
           0.0025        91.9695      0.0174844           1113     6.7298e-07           1378          10071
           0.0025        212.796      0.0184149           3458     6.9461e-07           1418          10607
           0.0025        103.206      0.0179896           1726    6.82168e-07           1395          10362
           0.0025        149.274      0.0184271           2347    6.73856e-07           1429          10614
           0.0025          114.1      0.0175226           1630    6.53135e-07           1361          10093
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
