% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_84_percent_with_pillar.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic transpose1  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
            0.001        23.5503     0.00707292             75     2.7458e-07            576           4074
            0.001        22.3862     0.00715799             84    2.77188e-07            580           4123
            0.001        22.8448     0.00687847             86    2.65573e-07            554           3962
            0.001        23.6223     0.00739757             93    2.97036e-07            601           4261
            0.001        22.9454     0.00698785             77    2.68721e-07            568           4025
            0.001        23.6462     0.00746181            101     2.8472e-07            602           4298
            0.001        22.9223     0.00731424             71    2.78044e-07            592           4213
            0.001         22.677     0.00678299             91    2.61031e-07            548           3907
            0.001         23.703     0.00732118            131    2.80486e-07            596           4217
            0.001        22.3759     0.00723785             75    2.75108e-07            588           4169
           0.0015        29.8444      0.0106406            120    4.12656e-07            855           6129
           0.0015        28.3852      0.0105781            203    4.00822e-07            849           6093
           0.0015         27.055      0.0104045            109    4.02859e-07            837           5993
           0.0015        26.9046      0.0100972            186    3.88261e-07            818           5816
           0.0015        29.5598      0.0101944            132    4.01867e-07            820           5872
           0.0015        28.7834      0.0107205            155    4.11695e-07            868           6175
           0.0015        28.1809      0.0109236            180    4.24292e-07            879           6292
           0.0015        27.8843      0.0107969            145    4.15138e-07            864           6219
           0.0015        27.3265      0.0109722            155    4.20314e-07            879           6320
           0.0015        27.6406      0.0102674            184    4.03071e-07            832           5914
            0.002        42.9704      0.0140451            470    5.36419e-07           1114           8090
            0.002        39.8777      0.0135347            470    5.26496e-07           1079           7796
            0.002        38.8554      0.0136684            422    5.22658e-07           1093           7873
            0.002        41.8657      0.0141111            521    5.44875e-07           1124           8128
            0.002        45.9451      0.0144566            429    5.53375e-07           1148           8327
            0.002        39.6378       0.013434            242    5.24408e-07           1074           7738
            0.002        36.9761      0.0146979            249    5.65189e-07           1170           8466
            0.002        46.7709      0.0145052            351    5.48375e-07           1161           8355
            0.002        35.5484      0.0136944            202    5.18658e-07           1096           7888
            0.002        41.5637      0.0148142            233     5.5328e-07           1185           8533
           0.0025         91.418      0.0173715           1138    6.40986e-07           1359          10006
           0.0025        98.8627      0.0179705           1912    6.70591e-07           1406          10351
           0.0025        105.449      0.0178316           1535    6.81715e-07           1394          10271
           0.0025        104.613      0.0186319           1806    6.89093e-07           1452          10732
           0.0025        134.905      0.0177552           3128    6.60687e-07           1381          10227
           0.0025        84.7092      0.0176927            920    6.69656e-07           1379          10191
           0.0025        77.5807      0.0174549           1223    6.46904e-07           1376          10054
           0.0025        116.482       0.017901           1788    6.73145e-07           1395          10311
           0.0025        113.404      0.0181441           2236    6.83157e-07           1420          10451
           0.0025        176.283      0.0177257           4513    6.61532e-07           1382          10210
            0.003         464.15      0.0204809           7013    7.23004e-07           1554          11797
            0.003        391.836      0.0201181           7187    7.13092e-07           1522          11588
            0.003        382.683      0.0203837           7621    7.22918e-07           1548          11741
            0.003        324.385      0.0200868           4889    7.10381e-07           1525          11570
            0.003         457.77      0.0202135           8090     7.1786e-07           1537          11643
            0.003        364.235      0.0199531           5513    7.20053e-07           1516          11493
            0.003        313.852      0.0206372           6743     7.1768e-07           1562          11887
            0.003        367.493      0.0197344           7471    7.14967e-07           1502          11367
            0.003        423.239      0.0199653           8180    7.15947e-07           1511          11500
            0.003         362.37      0.0205313           7348    7.25835e-07           1555          11826
           0.0035         472.54      0.0221631           7481    7.25226e-07           1614          12367
           0.0035        488.598      0.0212708           8060    7.25595e-07           1612          12252
           0.0035        397.022       0.022026           9355    7.48494e-07           1655          12687
           0.0035         404.16      0.0233879           6323    7.28228e-07           1619          12419
           0.0035         397.27      0.0220412           7608    7.37475e-07           1610          12299
           0.0035        506.916      0.0218208           8654    7.28283e-07           1591          12176
           0.0035        441.603      0.0216349           9071     7.4417e-07           1609          12267
           0.0035        501.829      0.0223853           8666     7.3893e-07           1635          12491
           0.0035        524.261      0.0215944           8755    7.38021e-07           1605          12244
           0.0035        361.042      0.0223297           9745    7.31102e-07           1601          12259
            0.004        403.233      0.0245179           7557    7.42221e-07           1685          13019
            0.004        396.107      0.0245273           7003      7.559e-07           1695          13024
            0.004        425.221      0.0229153           7819     7.4745e-07           1714          12993
            0.004        481.737      0.0259028           7876    7.40661e-07           1689          13055
            0.004          434.7      0.0246092           9234    7.50464e-07           1667          12846
            0.004        443.597      0.0249579           8477    7.54663e-07           1686          13028
            0.004         451.54      0.0251754           7458     7.4413e-07           1681          12915
            0.004        448.141      0.0252184           6327    7.42074e-07           1710          13164
            0.004        468.096      0.0256881           7604    7.53758e-07           1711          13178
            0.004        446.052      0.0228943           8057    7.38994e-07           1664          12775
           0.0045        542.664      0.0286852           7817    7.47853e-07           1804          13941
           0.0045         548.35      0.0272044           9182    7.54323e-07           1770          13711
           0.0045        391.783      0.0260395           8397    7.61943e-07           1796          13827
           0.0045        511.095      0.0274586           7780    7.29889e-07           1753          13592
           0.0045        588.178      0.0266171           7967    7.45006e-07           1732          13415
           0.0045        586.481      0.0265497           8559    7.46003e-07           1771          13620
           0.0045        499.622      0.0274753           7336    7.43761e-07           1721          13353
           0.0045         445.85      0.0266979           6719    7.52458e-07           1771          13696
           0.0045        491.841      0.0253446           9148     7.5646e-07           1735          13458
           0.0045        455.699      0.0277758           7758    7.57892e-07           1778          13749
            0.005        483.221      0.0288552           8621    7.76572e-07           1882          14543
            0.005        550.129      0.0284707           8219    7.41713e-07           1834          14093
            0.005        588.763      0.0285879           8780    7.50543e-07           1837          14151
            0.005        513.766      0.0290707           8104    7.61804e-07           1861          14390
            0.005        577.181      0.0295073           8018    7.45495e-07           1827          14075
            0.005        597.799      0.0291171           9262    7.62441e-07           1912          14675
            0.005        581.808      0.0276667           7949    7.43645e-07           1800          13944
            0.005        540.901      0.0276394           8013    7.42843e-07           1846          14179
            0.005        509.095      0.0272651           8339    7.42336e-07           1815          13987
            0.005        663.613      0.0278433           8338    7.51428e-07           1808          14033
           0.0055        584.841      0.0300655           9037    7.45739e-07           1952          15153
           0.0055        609.604      0.0306811           9190    7.66734e-07           1919          14911
           0.0055        571.751      0.0287697           7414    7.44827e-07           1838          14241
           0.0055        621.884      0.0303848           8329    7.41511e-07           1898          14767
           0.0055        571.982      0.0301276           8761    7.41656e-07           1905          14642
           0.0055        590.889      0.0305926           9086    7.59243e-07           1919          14868
           0.0055        639.124      0.0298036           9169    7.63874e-07           1945          15021
           0.0055        657.439      0.0302121           7457    7.64237e-07           1924          14955
           0.0055        599.349      0.0304423           8650    7.53431e-07           1871          14521
           0.0055        569.197      0.0299897           7726    7.51474e-07           1880          14575
            0.006        580.505       0.030602           8451    7.67861e-07           1939          15148
            0.006        564.312      0.0319733           8615    7.61808e-07           1999          15539
            0.006        521.413      0.0312828           8428    7.62385e-07           1985          15485
            0.006        637.999      0.0311429           8097    7.74825e-07           2029          15696
            0.006        567.463      0.0315577           9131    7.48611e-07           1944          15053
            0.006        531.851      0.0310165           8257    7.50998e-07           1949          15074
            0.006        642.422      0.0309879           8953     7.5176e-07           1969          15339
            0.006         575.76      0.0321803           8933     7.6034e-07           1977          15350
            0.006        555.205      0.0321677           9369    7.50574e-07           1975          15344
            0.006        560.197      0.0313807           9088    7.40263e-07           1973          15251
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
