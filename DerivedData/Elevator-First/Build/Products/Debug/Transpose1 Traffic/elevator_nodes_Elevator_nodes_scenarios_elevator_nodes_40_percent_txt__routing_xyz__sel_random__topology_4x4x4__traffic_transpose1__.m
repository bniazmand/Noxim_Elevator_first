% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_40_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_40_percent.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic transpose1  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_40_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
            0.005        30.7679      0.0364896            589    9.45684e-07           2874          21018
            0.005        25.0597      0.0373802            343    9.73915e-07           2950          21531
            0.005         24.371      0.0361319            627    9.35348e-07           2846          20812
            0.005        22.2039      0.0360938            221    9.42635e-07           2859          20790
            0.005         27.859      0.0365781            672    9.47814e-07           2887          21069
            0.005        24.8124      0.0365816            301     9.6067e-07           2884          21071
            0.005        22.9318      0.0350833            261     9.1701e-07           2773          20208
            0.005        21.0756      0.0351024            167    9.15495e-07           2763          20219
            0.005        24.1475      0.0356823            331     9.4663e-07           2828          20553
            0.005        24.3644      0.0353837            642    9.17782e-07           2794          20381
            0.006        34.5758      0.0426892           1200    1.12198e-06           3333          24589
            0.006        47.7566       0.044026           2658    1.14153e-06           3439          25359
            0.006        57.2419      0.0435087           3099     1.1285e-06           3398          25061
            0.006        42.0652      0.0448472           1770    1.16111e-06           3497          25832
            0.006        45.2919      0.0433733           1553     1.1393e-06           3391          24983
            0.006        32.6389       0.042941            800    1.10837e-06           3370          24734
            0.006        35.3608      0.0427917           1434    1.11867e-06           3370          24648
            0.006        31.9004      0.0427257            974    1.10156e-06           3354          24610
            0.006        47.8024      0.0424444           3086    1.10807e-06           3320          24448
            0.006         33.562      0.0430642            537    1.13853e-06           3386          24805
            0.007        119.899       0.049658           8147    1.27119e-06           3836          28603
            0.007         127.06      0.0498177           6696    1.26675e-06           3832          28695
            0.007        103.957      0.0494045           6938    1.26441e-06           3816          28457
            0.007        74.2242      0.0486076           3233    1.26033e-06           3778          27998
            0.007        120.446      0.0504323           7377    1.31075e-06           3895          29049
            0.007        111.038      0.0510451           6845    1.31029e-06           3948          29402
            0.007        73.5197      0.0498646           4814    1.28275e-06           3839          28722
            0.007        74.7273       0.050092           5674    1.28633e-06           3883          28853
            0.007        64.9916      0.0502812           3683    1.27926e-06           3907          28962
            0.007        64.5517      0.0498385           6208    1.28136e-06           3868          28707
            0.008        105.762       0.056191           8072    1.43657e-06           4313          32366
            0.008        135.781      0.0571623           8292    1.40868e-06           4303          32411
            0.008        128.983      0.0561597           5513    1.42725e-06           4293          32348
            0.008        117.886      0.0554201           7195    1.42201e-06           4264          31922
            0.008         163.98      0.0553003           7993    1.42874e-06           4229          31853
            0.008         125.16      0.0541111           8986    1.39839e-06           4144          31168
            0.008        119.008      0.0563767           8371    1.43319e-06           4317          32473
            0.008        87.2751      0.0556372           4641    1.41474e-06           4267          32047
            0.008         113.49      0.0572413           5812    1.44272e-06           4391          32971
            0.008          124.1      0.0560608           7315    1.43044e-06           4301          32291
            0.009        209.119      0.0604705           6748    1.52715e-06           4597          34831
            0.009        172.157      0.0611406           5850    1.53769e-06           4636          35217
            0.009        200.125      0.0629136           7619    1.54822e-06           4667          35672
            0.009        186.217      0.0619277           7364    1.55644e-06           4637          35113
            0.009        181.945      0.0627284           6758    1.54528e-06           4669          35567
            0.009        175.132      0.0611927           8495    1.52923e-06           4637          35247
            0.009        213.063      0.0621215           5683    1.55609e-06           4700          35782
            0.009        172.175      0.0631711           7760    1.56085e-06           4737          35818
            0.009        205.388      0.0618405           7157    1.50081e-06           4530          34507
            0.009        214.919      0.0620573           6282    1.54924e-06           4690          35745
             0.01        245.405      0.0675501           5417    1.60288e-06           4861          37085
             0.01        256.473      0.0656279           6426    1.61705e-06           4857          37211
             0.01        228.993      0.0660406           8256    1.62065e-06           4884          37445
             0.01        222.299      0.0655785           9783    1.61809e-06           4876          37183
             0.01        221.625      0.0661852           7500    1.60271e-06           4919          37527
             0.01        205.087      0.0674355           8809    1.62006e-06           4929          37629
             0.01         261.11      0.0666075           7005    1.60755e-06           4866          37167
             0.01        255.777      0.0654709           7740    1.59083e-06           4848          37122
             0.01        255.254      0.0673978           8210    1.61162e-06           4918          37608
             0.01        236.111      0.0677437           8135    1.63136e-06           4960          37801
            0.011        292.923       0.072224           8714    1.71035e-06           5219          39651
            0.011        311.219      0.0725173           8786    1.70448e-06           5209          39812
            0.011        299.164      0.0694283           9328    1.66387e-06           5065          38741
            0.011         333.66      0.0730128           9297    1.69561e-06           5222          40084
            0.011        289.752      0.0706721           6222    1.67191e-06           5060          38799
            0.011        313.091      0.0741815           8563     1.7073e-06           5218          40058
            0.011        424.042      0.0715574           8139     1.6901e-06           5106          39285
            0.011        324.597      0.0701975           8206    1.71164e-06           5216          39802
            0.011        364.485      0.0731611           8251    1.69574e-06           5154          39507
            0.011        481.753      0.0711876           8989    1.68118e-06           5104          39082
            0.012        420.632      0.0772389           9033    1.78936e-06           5408          41709
            0.012        407.872      0.0761426           8061    1.75584e-06           5351          41117
            0.012        549.472      0.0774369           8349    1.75045e-06           5324          41119
            0.012        434.068      0.0772926           8820    1.75862e-06           5430          41738
            0.012        422.247      0.0778593           9117    1.79032e-06           5482          42044
            0.012        479.923      0.0775037           8204    1.77879e-06           5449          41852
            0.012        500.651      0.0767571           7363    1.73364e-06           5269          40758
            0.012        517.776      0.0766271           9229     1.7438e-06           5297          40689
            0.012        422.061      0.0756612           9197    1.75283e-06           5394          41538
            0.012        497.845      0.0776139           8210    1.75722e-06           5359          41213
            0.013        567.003      0.0812957           9558    1.80368e-06           5598          43168
            0.013        489.516      0.0807056           9771    1.83983e-06           5647          43581
            0.013        538.726      0.0788907           8269    1.80041e-06           5504          42601
            0.013         524.74      0.0794037           9448    1.80909e-06           5557          42878
            0.013        526.107      0.0815047           9578    1.83391e-06           5536          43279
            0.013        485.695      0.0802441           6987    1.84874e-06           5707          44054
            0.013        581.278      0.0845828           7567    1.83279e-06           5598          43391
            0.013        486.762      0.0814576           9020    1.83037e-06           5625          43254
            0.013        451.981      0.0791593           8514    1.81028e-06           5541          42746
            0.013        580.989      0.0808475           7437    1.82269e-06           5533          42930
            0.014        604.419      0.0866973           7271    1.89626e-06           5837          45256
            0.014        562.729      0.0863333           7833    1.93715e-06           5906          45843
            0.014        565.694      0.0862299           8537    1.90063e-06           5803          45012
            0.014        557.256      0.0888187           8114    1.90576e-06           5847          45564
            0.014        622.412      0.0830204           9121    1.88243e-06           5754          44831
            0.014        564.128      0.0830498           7056    1.83332e-06           5588          43352
            0.014        663.753      0.0869636           9050    1.91699e-06           5855          45395
            0.014        694.689      0.0841303           8951    1.85447e-06           5675          43916
            0.014        774.894      0.0862318           8213     1.9061e-06           5759          45013
            0.014        548.828      0.0808738           7740    1.82561e-06           5545          42944
            0.015        757.527      0.0893103           9308    1.94723e-06           5983          46620
            0.015        718.788      0.0903119           8228    1.92993e-06           5939          46330
            0.015        651.771      0.0932202           6903    1.94027e-06           6048          46983
            0.015        706.396       0.090076           8691    1.93226e-06           5937          46209
            0.015         774.56      0.0870785           9722    1.90768e-06           5840          45455
            0.015        676.519      0.0869138           8133    1.91027e-06           5842          45369
            0.015        701.905      0.0849685           8055    1.94531e-06           5926          45883
            0.015        637.277      0.0885096           9117    1.94405e-06           5916          46202
            0.015        736.005      0.0877912           7064    1.94196e-06           5891          45827
            0.015        646.799      0.0876573           8448    1.93069e-06           5996          46546
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
