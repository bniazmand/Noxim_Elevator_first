% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_40_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_40_percent.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic transpose1  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_40_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_transpose1__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
            0.002        15.0554       0.014441            103    3.86306e-07           1173           8318
            0.002        15.0467      0.0140642             77    3.77057e-07           1135           8101
            0.002        14.1625      0.0139271             61    3.65155e-07           1126           8022
            0.002        14.6892      0.0133125             68    3.56513e-07           1081           7668
            0.002        14.7386      0.0140642             78    3.75856e-07           1140           8101
            0.002        14.8154      0.0139809             74    3.87077e-07           1127           8053
            0.002        14.9282      0.0144896             58    3.86626e-07           1170           8346
            0.002        14.6767      0.0146858             66    3.90603e-07           1194           8459
            0.002         14.814       0.013816             72    3.76441e-07           1118           7958
            0.002        14.3316      0.0140139             60    3.70694e-07           1131           8072
           0.0025        14.9173      0.0175642             68    4.66637e-07           1415          10117
           0.0025        15.0227      0.0179097             63    4.73894e-07           1451          10316
           0.0025        15.3213      0.0177778             71    4.72881e-07           1435          10240
           0.0025        15.0981      0.0172899             95    4.54208e-07           1396           9959
           0.0025        15.8202      0.0179028             91    4.80011e-07           1446          10312
           0.0025        15.7796      0.0176111             67    4.68334e-07           1420          10144
           0.0025        15.5952      0.0174583             85    4.66551e-07           1408          10056
           0.0025        15.5549      0.0172118             78    4.59554e-07           1393           9914
           0.0025        15.7125       0.018901             86    4.99697e-07           1527          10887
           0.0025        15.1198      0.0174531             53    4.61685e-07           1411          10053
            0.003        16.4351      0.0221545            105    6.00245e-07           1781          12761
            0.003         16.251      0.0211615             92    5.56362e-07           1709          12189
            0.003        16.3568      0.0218455             89    5.79084e-07           1749          12583
            0.003        16.2466      0.0212257             89    5.60805e-07           1703          12226
            0.003        16.0554      0.0206337             76    5.53408e-07           1662          11885
            0.003        16.7913      0.0214878            147    5.70452e-07           1720          12377
            0.003        16.5713      0.0213594            100    5.76557e-07           1710          12303
            0.003        16.7982      0.0205503            135    5.51731e-07           1655          11837
            0.003        16.1458      0.0207743             70    5.54036e-07           1667          11966
            0.003        16.7869      0.0210104            127    5.62095e-07           1689          12102
           0.0035        17.6701       0.025151            119    6.60794e-07           2013          14487
           0.0035        17.8598      0.0248819            114    6.76668e-07           1990          14332
           0.0035        17.2369      0.0257448            129    6.81497e-07           2064          14829
           0.0035        17.2631      0.0250694            143    6.59319e-07           2011          14440
           0.0035        17.8841      0.0246337            142    6.57678e-07           1975          14189
           0.0035        17.8591      0.0254774            201    6.82306e-07           2037          14675
           0.0035        17.9638      0.0238854            174    6.35323e-07           1905          13758
           0.0035        17.7122      0.0246892            145    6.53337e-07           1984          14221
           0.0035        18.0444      0.0255729            160     6.6673e-07           2050          14730
           0.0035        18.0385      0.0243802            179    6.52167e-07           1947          14043
            0.004         18.915      0.0287135            133    7.55312e-07           2294          16539
            0.004        18.8794      0.0293524            144     7.7921e-07           2338          16907
            0.004        18.3189      0.0270052            182    7.12719e-07           2170          15555
            0.004        18.3621      0.0280868            170    7.40884e-07           2240          16178
            0.004        19.4716      0.0277882            178    7.53127e-07           2220          16006
            0.004        19.6512       0.028908            160    7.71481e-07           2302          16651
            0.004        18.4579      0.0279931            193    7.45356e-07           2234          16124
            0.004        18.4159      0.0283854            124    7.56272e-07           2270          16350
            0.004        19.2707      0.0280208            140    7.48873e-07           2246          16140
            0.004        18.6172      0.0284688            168    7.43522e-07           2270          16398
           0.0045        19.9392      0.0307205            168     8.1525e-07           2436          17695
           0.0045        19.7964      0.0318455            124    8.46359e-07           2539          18343
           0.0045        21.0821      0.0321319            190    8.46813e-07           2547          18508
           0.0045        19.6707      0.0319826            161    8.33237e-07           2542          18422
           0.0045         20.974      0.0323229            159    8.56244e-07           2573          18618
           0.0045        21.2797      0.0323542            268    8.61025e-07           2571          18636
           0.0045        21.3046      0.0316007            416    8.26301e-07           2515          18202
           0.0045        23.0533      0.0327587            326    8.66606e-07           2610          18869
           0.0045         22.835       0.032184            478    8.41671e-07           2552          18538
           0.0045        22.4168      0.0323681            225    8.60674e-07           2555          18644
            0.005        21.8447      0.0351597            288    9.14885e-07           2782          20252
            0.005         20.801      0.0352031            166    9.21916e-07           2784          20277
            0.005        21.7872      0.0351458            165    9.11931e-07           2782          20244
            0.005         21.729      0.0356441            200    9.23986e-07           2845          20531
            0.005        23.7147      0.0354514            217    9.36966e-07           2808          20420
            0.005        23.5055      0.0347153            542    9.20333e-07           2750          19996
            0.005        21.1786      0.0351927            204    9.14704e-07           2794          20271
            0.005        25.5734      0.0367448            414    9.60784e-07           2900          21165
            0.005        23.3615      0.0352153            271    9.29439e-07           2783          20284
            0.005        26.3353      0.0360052            343    9.58488e-07           2854          20739
           0.0055        28.0526      0.0406007            562    1.04794e-06           3191          23386
           0.0055        28.9544      0.0382795            569    1.00938e-06           3027          22049
           0.0055        25.4847      0.0383385            278     1.0016e-06           3033          22083
           0.0055        24.2186      0.0394635            202    1.03254e-06           3110          22731
           0.0055        26.1227      0.0379601            581    1.00486e-06           2999          21865
           0.0055        30.1352      0.0400538            647    1.04503e-06           3143          23071
           0.0055        23.6364      0.0374219            357    9.83057e-07           2965          21555
           0.0055        29.4793      0.0395365            679    1.03724e-06           3115          22773
           0.0055        27.3096      0.0388559            406    1.01229e-06           3049          22381
           0.0055        25.5384      0.0388941            541    1.01639e-06           3072          22403
            0.006        45.5817      0.0426528           1653    1.11171e-06           3325          24568
            0.006        26.8791      0.0422187            260    1.09777e-06           3316          24318
            0.006         51.064      0.0435938           1228    1.13469e-06           3404          25110
            0.006        45.7613      0.0428958           1166    1.12037e-06           3335          24708
            0.006        36.4982       0.043217           1208     1.1217e-06           3384          24893
            0.006        43.4949      0.0431858           1178    1.12383e-06           3358          24875
            0.006        39.2613      0.0421649           1467    1.09345e-06           3303          24287
            0.006        34.6899      0.0436649            578    1.14235e-06           3402          25151
            0.006        51.3449      0.0436181           2161    1.11462e-06           3410          25124
            0.006        41.6603      0.0424062           1402    1.11003e-06           3329          24426
           0.0065        57.6204      0.0472969           3248    1.21334e-06           3688          27243
           0.0065        37.0186      0.0448108            888     1.1526e-06           3497          25811
           0.0065        67.6387      0.0466649           4370    1.20942e-06           3634          26879
           0.0065        43.9428      0.0469149           2315    1.21824e-06           3651          27023
           0.0065        49.7619      0.0459375           1676     1.1936e-06           3583          26460
           0.0065        73.8677      0.0473872           4363    1.23126e-06           3673          27295
           0.0065        82.9676      0.0466441           4838    1.21727e-06           3641          26867
           0.0065        58.7258      0.0469497           2020     1.1973e-06           3643          27043
           0.0065        74.0546      0.0463333           4599    1.19846e-06           3607          26688
           0.0065        79.8196      0.0457031           6532    1.19327e-06           3542          26325
            0.007        62.4263      0.0494549           4505    1.28167e-06           3849          28486
            0.007        66.9279      0.0495365           5537    1.26902e-06           3840          28533
            0.007        80.1725       0.050717           5256    1.30884e-06           3918          29213
            0.007        80.3797      0.0502986           7012    1.30381e-06           3911          28972
            0.007        97.1082      0.0502049           5669    1.27793e-06           3880          28918
            0.007        67.5465      0.0495538           8895    1.28726e-06           3841          28543
            0.007        82.7703      0.0491076           6290    1.26321e-06           3810          28286
            0.007        95.3663      0.0507292           8920    1.29865e-06           3918          29220
            0.007        70.7344      0.0499583           4949     1.2745e-06           3874          28776
            0.007        101.099      0.0499323           7981    1.28949e-06           3848          28761
           0.0075        98.7681      0.0522726           5443    1.34695e-06           4028          30109
           0.0075        147.578      0.0525399           7413    1.34891e-06           4049          30263
           0.0075         91.153      0.0537153           2291    1.36862e-06           4137          30940
           0.0075        85.9779      0.0534861           8264    1.36408e-06           4117          30808
           0.0075        103.508      0.0533264           8049    1.35896e-06           4107          30716
           0.0075        99.3781      0.0539722           7309    1.38688e-06           4150          31088
           0.0075        95.6825      0.0535885           7012    1.38303e-06           4132          30867
           0.0075        181.077      0.0523003           5790    1.34017e-06           4006          30125
           0.0075        110.076      0.0543924           7721    1.38469e-06           4182          31330
           0.0075        98.8496      0.0526024           6814    1.34652e-06           4049          30299
            0.008        153.326       0.057291           7165    1.41859e-06           4313          32484
            0.008         113.15      0.0556076           9526    1.40693e-06           4270          32030
            0.008        121.919      0.0559383           5201    1.40263e-06           4215          31717
            0.008        107.876      0.0567656           6855      1.443e-06           4341          32697
            0.008        116.669      0.0573122           5750     1.4398e-06           4323          32496
            0.008        107.115      0.0543889           9074    1.39631e-06           4195          31328
            0.008        100.789      0.0566684           5232     1.4398e-06           4354          32641
            0.008        117.733       0.056092           7114    1.41875e-06           4302          32309
            0.008        111.229      0.0574028           4943    1.45694e-06           4394          33064
            0.008        122.962      0.0560955           5737     1.4311e-06           4325          32311
           0.0085        182.231      0.0591597           8073    1.48897e-06           4501          34076
           0.0085        140.684      0.0597743           9202    1.48226e-06           4477          33892
           0.0085        134.481      0.0591975           5672    1.47945e-06           4450          33565
           0.0085        124.442      0.0575087           8162    1.43951e-06           4391          33125
           0.0085        211.842      0.0602674           7640    1.50614e-06           4588          34714
           0.0085        181.361      0.0599347           8637    1.47593e-06           4501          33983
           0.0085        181.948      0.0606384           5841    1.50463e-06           4542          34382
           0.0085        161.719      0.0606233           5475    1.51957e-06           4630          34919
           0.0085        219.562      0.0596878           7746    1.47128e-06           4462          33843
           0.0085        113.477      0.0582101           7788    1.47836e-06           4456          33529
            0.009        202.152      0.0625556           5848    1.53505e-06           4673          35469
            0.009         206.64      0.0634498           8040    1.54927e-06           4641          35405
            0.009        169.545      0.0613598           8424    1.51413e-06           4580          34791
            0.009        198.311      0.0619753           6933    1.53032e-06           4615          35140
            0.009        196.551      0.0621146           5494    1.53957e-06           4626          35219
            0.009        251.401      0.0618594           8947    1.53312e-06           4670          35631
            0.009        193.528          0.063           4478    1.55814e-06           4702          35721
            0.009        199.276       0.063914           7570    1.53365e-06           4699          35664
            0.009        222.749      0.0631505           8083    1.54131e-06           4642          35238
            0.009        217.154      0.0631039           9047    1.53068e-06           4623          35212
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
