% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_bitreversal__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_84_percent_with_pillar.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic bitreversal  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_84_percent_with_pillar_txt__routing_xyz__sel_random__topology_4x4x4__traffic_bitreversal__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
            0.001         16.264     0.00748611             60    2.04218e-07            534           3773
            0.001        15.6371     0.00696825             54    1.88788e-07            496           3512
            0.001        15.9792     0.00673611             58    1.82747e-07            480           3395
            0.001        16.4056     0.00693056             60    1.88862e-07            498           3493
            0.001        15.9896     0.00673611             54    1.86932e-07            483           3395
            0.001        15.7221     0.00691071             44    1.85428e-07            493           3483
            0.001        16.1931     0.00728571             66    1.97114e-07            523           3672
            0.001        15.6781     0.00692063             46    1.86496e-07            494           3488
            0.001        15.8009     0.00649206             49    1.78626e-07            467           3272
            0.001        16.0725     0.00677381             58    1.89263e-07            483           3414
           0.0015        16.1038      0.0109087             81     2.8632e-07            771           5498
           0.0015        16.8632      0.0106587             83    2.80814e-07            753           5372
           0.0015        16.2999       0.010246             67    2.73249e-07            727           5164
           0.0015        16.4801      0.0102103             64    2.68918e-07            729           5146
           0.0015        16.6885      0.0107163             81    2.89842e-07            764           5401
           0.0015        16.7757      0.0107937             73    2.85701e-07            767           5440
           0.0015         17.201      0.0112897             79    3.00051e-07            801           5690
           0.0015        16.9879      0.0105317             95    2.90463e-07            743           5308
           0.0015        16.3435      0.0101865             70    2.75556e-07            722           5134
           0.0015        16.7539      0.0108175             89    2.89877e-07            768           5452
            0.002        17.5669      0.0137321             83    3.59804e-07            979           6921
            0.002        17.5374      0.0140159            109    3.63025e-07            990           7064
            0.002        17.2948      0.0130873             79    3.50298e-07            926           6596
            0.002        18.1024      0.0138036             90    3.68392e-07            977           6957
            0.002        18.1186      0.0145992             90    3.86872e-07           1029           7358
            0.002        18.1303      0.0150218            100    4.03685e-07           1059           7571
            0.002        19.5014      0.0151528            122    4.08221e-07           1069           7637
            0.002        18.6228      0.0141825             95    3.79118e-07           1002           7148
            0.002        18.0695      0.0138313             77    3.63182e-07            978           6971
            0.002        18.0984      0.0151647            113    3.99058e-07           1077           7643
           0.0025        19.1951      0.0172877            132    4.56446e-07           1220           8713
           0.0025         19.372      0.0179464            202    4.71491e-07           1266           9045
           0.0025        20.9156      0.0171627            163    4.64816e-07           1209           8650
           0.0025        18.6318      0.0174067            109    4.53311e-07           1233           8773
           0.0025        19.5214      0.0179246            133    4.73981e-07           1264           9034
           0.0025        19.8479      0.0170655            134    4.52442e-07           1210           8601
           0.0025        20.0506      0.0178909            142    4.71882e-07           1266           9017
           0.0025        21.5123      0.0179385            152    4.81911e-07           1265           9041
           0.0025        20.7195       0.017625            178    4.66086e-07           1237           8883
           0.0025        19.8008       0.017877             97    4.82488e-07           1255           9010
            0.003        22.1819      0.0212937            230    5.72931e-07           1495          10732
            0.003        21.8958      0.0210337            155    5.56641e-07           1478          10601
            0.003        24.8117      0.0211607            455    5.63716e-07           1492          10665
            0.003        23.1118      0.0206766            212    5.52174e-07           1449          10421
            0.003         21.737      0.0212163            135    5.58349e-07           1483          10693
            0.003         23.741      0.0213929            267    5.77885e-07           1498          10782
            0.003        21.1685      0.0207421            134    5.48097e-07           1448          10454
            0.003        21.2018      0.0211548            121    5.59184e-07           1477          10662
            0.003         23.117      0.0210298            190     5.6726e-07           1470          10599
            0.003        22.4326       0.020994            173    5.55565e-07           1477          10581
           0.0035        23.7037      0.0238353            176    6.23671e-07           1664          12013
           0.0035        25.3178      0.0246746            245    6.52419e-07           1718          12436
           0.0035        27.4277      0.0250159            194    6.60763e-07           1749          12608
           0.0035         25.225      0.0248631            201    6.43201e-07           1729          12531
           0.0035        27.3124      0.0253294            350    6.65939e-07           1764          12766
           0.0035        28.2085      0.0248056            370    6.42912e-07           1727          12502
           0.0035        22.7913      0.0246687            134    6.41063e-07           1730          12433
           0.0035        27.3784      0.0254821            283    6.77231e-07           1781          12843
           0.0035        25.2865       0.024879            215    6.46551e-07           1738          12539
           0.0035        27.5228      0.0252024            587    6.59092e-07           1754          12702
            0.004        40.9422      0.0299484            485    7.84339e-07           2060          15094
            0.004        35.4605      0.0280833            516    7.42365e-07           1950          14154
            0.004        44.2371        0.02925            725    7.53633e-07           2020          14742
            0.004        33.4388      0.0289008            288    7.52932e-07           1994          14566
            0.004        32.6804          0.029            400    7.63652e-07           2012          14616
            0.004        33.4882      0.0282262            431    7.49555e-07           1948          14226
            0.004        31.1865      0.0297163            349    7.61322e-07           2064          14977
            0.004        33.7398      0.0289504            259    7.62109e-07           2002          14591
            0.004        39.2596      0.0284663            881    7.45305e-07           1980          14347
            0.004        30.3383      0.0287421            319    7.53207e-07           1998          14486
           0.0045        53.6055      0.0317222            978    8.18741e-07           2185          15988
           0.0045        51.7905      0.0324643            963    8.45839e-07           2239          16362
           0.0045        160.972      0.0329345           4607    8.48753e-07           2247          16599
           0.0045        41.7887      0.0319048            837    8.32457e-07           2205          16080
           0.0045        53.3434      0.0327857           1029    8.41719e-07           2251          16524
           0.0045        48.6893      0.0315893            824    8.16347e-07           2182          15921
           0.0045        79.3709      0.0335099           1866    8.43617e-07           2278          16889
           0.0045        50.6138      0.0319683            734    8.23323e-07           2196          16112
           0.0045        54.2005      0.0321607           1038    8.39759e-07           2214          16209
           0.0045         50.591       0.031879           1082    8.31781e-07           2198          16067
            0.005        165.321       0.035748           4518    9.18056e-07           2401          18017
            0.005        106.828      0.0345218           2493    8.97956e-07           2343          17399
            0.005        130.206      0.0350952           5912    9.04393e-07           2364          17688
            0.005        143.082      0.0355813           4964    8.82606e-07           2409          17933
            0.005         86.365      0.0350258           1156    8.87332e-07           2381          17653
            0.005        116.845       0.035506           4038    8.86751e-07           2399          17895
            0.005        196.873      0.0352063           3807    8.86738e-07           2355          17744
            0.005        144.282      0.0353472           3350    9.00846e-07           2394          17815
            0.005        200.718      0.0368552           3660    9.34851e-07           2481          18575
            0.005        255.778      0.0354167           7172    8.99611e-07           2377          17850
           0.0055        308.942      0.0382123           5333    9.40148e-07           2547          19259
           0.0055        248.295      0.0379067           7493    9.37335e-07           2535          19105
           0.0055        294.245      0.0381488           5839    9.25157e-07           2547          19227
           0.0055        268.427      0.0392778           5477     9.5162e-07           2626          19796
           0.0055         276.88       0.037752           6607    9.31065e-07           2529          19027
           0.0055        258.593      0.0372996           6569    9.25198e-07           2501          18799
           0.0055        194.536      0.0371369           3823    9.24626e-07           2496          18717
           0.0055        254.605      0.0375298           8055     9.2688e-07           2509          18915
           0.0055        308.293      0.0380496           6522    9.26421e-07           2545          19177
           0.0055        246.448      0.0386766           5381    9.30615e-07           2602          19493
            0.006        343.266      0.0395456           7132    9.46855e-07           2631          19931
            0.006        342.084      0.0391687           7185    9.37372e-07           2619          19741
            0.006        408.884      0.0385754           7747    9.45329e-07           2581          19442
            0.006         340.78      0.0396687           7003    9.51582e-07           2646          19993
            0.006        341.762       0.039377           7910     9.4923e-07           2626          19846
            0.006        337.435      0.0386845           7751    9.45525e-07           2591          19497
            0.006        441.179      0.0380833           8135    9.26414e-07           2537          19194
            0.006        410.207       0.039123           9378      9.468e-07           2596          19718
            0.006        349.425       0.039119           6859     9.4946e-07           2604          19716
            0.006        331.872      0.0394702           7920     9.4336e-07           2628          19893
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
