% fname: elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_20_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_bitreversal__.m
% ./Elevator-First -elevator_nodes Elevator_nodes_scenarios/elevator_nodes_20_percent.txt -routing xyz -sel random -dimx 4 -dimy 4 -traffic bitreversal  -sim 10000 -warmup 1000 -size 8 8 -buffer 4 

function [max_pir, max_throughput, min_delay] = elevator_nodes_Elevator_nodes_scenarios_elevator_nodes_20_percent_txt__routing_xyz__sel_random__topology_4x4x4__traffic_bitreversal__(symbol)

data = [
%             pir      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
            0.005        12.4526      0.0358968            102    6.35604e-07           2521          18092
            0.005        11.9406      0.0349901             73    6.09229e-07           2457          17635
            0.005        11.9865      0.0345298            101    5.98807e-07           2438          17403
            0.005        11.9011      0.0359504             91    6.05332e-07           2517          18119
            0.005        11.7583       0.034496            100     5.8938e-07           2416          17386
            0.005        12.2092      0.0353155             93     6.1525e-07           2471          17799
            0.005        12.0573      0.0357996            110    6.21735e-07           2530          18043
            0.005        12.3646      0.0362242            100    6.25736e-07           2545          18257
            0.005        11.8324      0.0348016             71    6.03501e-07           2441          17540
            0.005        11.6399      0.0352282             83    5.97001e-07           2480          17755
            0.006         12.682      0.0426171            150    7.37082e-07           2981          21479
            0.006        13.4395      0.0439147            112    7.52256e-07           3067          22133
            0.006        13.2669      0.0423095            125     7.1228e-07           2956          21324
            0.006        12.4743      0.0437302            109    7.39538e-07           3059          22040
            0.006        12.4843      0.0427937            132    7.38802e-07           2998          21568
            0.006        12.9642      0.0427401            124    7.33736e-07           2988          21541
            0.006        12.8273      0.0420516            110    7.25175e-07           2935          21194
            0.006        13.2996      0.0435496            156    7.48059e-07           3044          21949
            0.006        12.7075      0.0427103            148    7.26096e-07           2974          21526
            0.006        13.3491      0.0428671            119    7.50778e-07           2982          21605
            0.007        14.8172      0.0496944            224    8.56331e-07           3452          25046
            0.007        14.4538      0.0499901            117    8.58844e-07           3477          25195
            0.007        14.1056      0.0507321            131     8.7607e-07           3533          25569
            0.007        13.5098      0.0484147            125    8.29392e-07           3360          24401
            0.007        14.1005      0.0494306            167    8.52795e-07           3433          24913
            0.007        13.8874      0.0503075            123    8.71464e-07           3499          25355
            0.007        13.8396      0.0483452            167    8.26081e-07           3373          24366
            0.007        13.9316      0.0503433            190    8.44688e-07           3493          25373
            0.007        14.5424      0.0493373            174    8.53311e-07           3433          24866
            0.007        14.2596      0.0508056            188    8.71743e-07           3529          25606
            0.008        17.5279      0.0568274            283    9.66886e-07           3942          28641
            0.008        16.6387      0.0564147            327    9.71691e-07           3911          28433
            0.008         14.466       0.055998            245     9.5396e-07           3856          28223
            0.008        16.6722      0.0566746            345    9.72258e-07           3917          28564
            0.008        16.5649      0.0570218            438    9.84534e-07           3909          28739
            0.008        16.2736      0.0577004            230    9.83192e-07           3977          29081
            0.008        16.0295      0.0548532            255    9.49346e-07           3794          27646
            0.008        17.3476      0.0559444            339    9.61301e-07           3864          28196
            0.008        17.3335      0.0570456            279    9.72633e-07           3943          28751
            0.008        17.7747      0.0576925            426    9.80987e-07           3977          29077
            0.009        18.6603      0.0632063            535    1.07305e-06           4345          31856
            0.009        17.6603      0.0640556            267    1.08566e-06           4413          32284
            0.009        28.6848      0.0655972           1347    1.10901e-06           4502          33061
            0.009        16.9532        0.06375            375      1.076e-06           4406          32130
            0.009        18.7215      0.0637897            308    1.07698e-06           4391          32150
            0.009        18.6431      0.0639425            544    1.08806e-06           4396          32227
            0.009        19.5755      0.0649643            531    1.10621e-06           4488          32742
            0.009         17.651      0.0641151            349    1.08434e-06           4407          32314
            0.009        18.6256      0.0647798            426    1.08439e-06           4461          32649
            0.009        20.1603      0.0625298            656    1.07392e-06           4273          31515
             0.01        22.7958      0.0723929            487     1.2195e-06           4950          36486
             0.01        24.0412      0.0729663            854    1.22843e-06           4972          36775
             0.01        35.5021      0.0709643           2298    1.19908e-06           4838          35766
             0.01        29.1158       0.071379           1305    1.22443e-06           4898          35975
             0.01        22.9791      0.0722242            534    1.21414e-06           4937          36401
             0.01        34.5129       0.072494           1289    1.21451e-06           4948          36537
             0.01        21.6458      0.0730655            402    1.23732e-06           4978          36825
             0.01        31.1398      0.0718889            988    1.21841e-06           4892          36232
             0.01        38.4645      0.0725397           2347    1.23187e-06           4962          36560
             0.01        23.7749      0.0728393            946    1.21813e-06           4989          36711
            0.011        38.8575      0.0788948           2638     1.3122e-06           5349          39763
            0.011        54.5025      0.0792044           2418    1.33236e-06           5359          39919
            0.011         63.914      0.0810119           3674     1.3675e-06           5468          40830
            0.011        53.9842      0.0809722           4268     1.3617e-06           5458          40810
            0.011        52.7763      0.0784028           5090    1.31143e-06           5333          39515
            0.011        50.8728      0.0795139           3212    1.34545e-06           5387          40075
            0.011        60.4506      0.0796627           4141    1.33634e-06           5413          40150
            0.011        39.3077       0.079127           1205     1.3269e-06           5388          39880
            0.011        45.7409      0.0796111           2206    1.33728e-06           5391          40124
            0.011        41.9815      0.0797024           3504    1.33513e-06           5415          40170
            0.012        62.2739      0.0859881           3882    1.42954e-06           5805          43338
            0.012        57.1605      0.0865337           6116    1.43788e-06           5833          43613
            0.012        66.0171      0.0846925           6928    1.41677e-06           5746          42685
            0.012        51.1475       0.083371           7749    1.39865e-06           5629          42019
            0.012        65.8591      0.0845317           4621    1.41288e-06           5706          42604
            0.012        67.4947      0.0844544           5388    1.42148e-06           5700          42565
            0.012        59.9853      0.0879226           5973    1.47013e-06           5907          44313
            0.012        60.5877      0.0867996           3112    1.43606e-06           5869          43747
            0.012        68.0836       0.084506           8024     1.4042e-06           5719          42591
            0.012        52.5941      0.0858631           4129    1.44036e-06           5809          43275
            0.013        90.6848      0.0924544           7153    1.52259e-06           6209          46597
            0.013        83.8467      0.0919821           3330    1.52977e-06           6156          46359
            0.013        134.463      0.0910417           7470    1.52694e-06           6127          45885
            0.013        133.887       0.090752           7452    1.51358e-06           6114          45739
            0.013        105.128      0.0910635           4884    1.52033e-06           6112          45896
            0.013        107.239      0.0935258           6003    1.54621e-06           6274          47137
            0.013        84.5265      0.0937401           2682    1.54352e-06           6306          47245
            0.013        77.2936      0.0924563           3361     1.5381e-06           6233          46598
            0.013        97.9591      0.0928294           9187    1.54745e-06           6259          46786
            0.013        75.6326       0.092502           7811    1.54822e-06           6206          46621
            0.014        126.727       0.100246           3769    1.64703e-06           6678          50524
            0.014        101.307       0.097879           6431     1.6132e-06           6491          49331
            0.014        106.314      0.0980258           4447     1.6253e-06           6521          49405
            0.014        114.177      0.0982401           3907       1.63e-06           6574          49513
            0.014        131.588      0.0973294           7096    1.60631e-06           6541          49054
            0.014         124.46      0.0981567           8206    1.61331e-06           6551          49471
            0.014        125.517      0.0993495           5417    1.61356e-06           6510          49178
            0.014        105.681      0.0985434           3684    1.59237e-06           6521          48779
            0.014         88.427      0.0988182           4351    1.61849e-06           6515          48915
            0.014        125.151       0.103406           3921    1.66815e-06           6783          51186
            0.015        143.676        0.10481           4218    1.72695e-06           7024          52824
            0.015        123.372       0.105508           5577    1.72946e-06           7077          53176
            0.015        143.669       0.104519           4675    1.69888e-06           6867          51737
            0.015        117.546       0.107949           6411    1.72993e-06           7056          53435
            0.015        150.015       0.109618           4797    1.76328e-06           7188          54261
            0.015         118.44       0.105709           6107    1.69521e-06           6939          52326
            0.015        107.742       0.105687           5197    1.73805e-06           7080          53266
            0.015        118.182       0.106539           5630    1.70964e-06           6996          52737
            0.015         151.81       0.106022           5759    1.71076e-06           6966          52481
            0.015        148.245       0.106495           5293    1.71016e-06           6965          52715
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

figure(1);
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

figure(2);
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

figure(3);
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

figure(4);
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
